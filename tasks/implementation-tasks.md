# 音声通知MCP Server 実装タスク

## 概要
macOS専用の音声通知MCPサーバーを実装する。AIが自律的に音声通知を行い、ユーザー体験を向上させる。

## タスク一覧

### 1. プロジェクト初期設定 [Priority: High]
- [ ] Goモジュールの初期化 (`go mod init github.com/kyong0612/voice-notify-mcp`)
- [ ] 必要な依存関係の追加 (`golang.org/x/tools`)
- [ ] `.gitignore`ファイルの作成
- [ ] プロジェクト構造の作成

### 2. MCPサーバー基盤の実装 [Priority: High]
- [ ] `main.go`: エントリーポイントの実装
  - [ ] MCPサーバーの初期化
  - [ ] シグナルハンドリング
  - [ ] グレースフルシャットダウン
- [ ] `server.go`: MCPサーバーコア実装
  - [ ] MCPプロトコルの実装
  - [ ] ツール登録機能
  - [ ] リクエスト/レスポンスハンドリング

### 3. 音声通知機能の実装 [Priority: High]
- [ ] `voice.go`: 音声処理ロジック
  - [ ] `say`コマンドの実行関数
  - [ ] 利用可能な音声一覧の取得（`say -v '?'`）
  - [ ] 音声の検証とフォールバック機能
  - [ ] コマンドインジェクション対策
- [ ] `language.go`: 言語検出ロジック
  - [ ] メッセージからの言語自動検出
  - [ ] 言語に応じた音声選択
  - [ ] デフォルト言語の処理

### 4. 自律的通知機能の実装 [Priority: Medium]
- [ ] `notification.go`: 通知判定ロジック
  - [ ] 通知タイミングの判定
  - [ ] 優先度に基づく処理
  - [ ] 静音時間帯のチェック
  - [ ] 連続通知の抑制

### 5. 環境変数管理 [Priority: Medium]
- [ ] 環境変数の読み込み処理
  - [ ] `VOICE_NOTIFY_DEFAULT_VOICE`
  - [ ] `VOICE_NOTIFY_DEFAULT_LANGUAGE`
  - [ ] `VOICE_NOTIFY_AUTO_DETECT_LANGUAGE`
  - [ ] `VOICE_NOTIFY_AUTO_NOTIFY`
  - [ ] `VOICE_NOTIFY_MIN_TASK_DURATION`
  - [ ] `VOICE_NOTIFY_QUIET_HOURS`
- [ ] デフォルト値の設定
- [ ] 環境変数の検証

### 6. MCPツール定義 [Priority: High]
- [ ] `notify_voice`ツールの実装
  - [ ] 入力スキーマの定義
  - [ ] パラメータ検証
  - [ ] ツール実行ロジック
  - [ ] エラーハンドリング

### 7. エラーハンドリングとログ [Priority: Medium]
- [ ] 統一的なエラーハンドリング
- [ ] ログ出力の実装
- [ ] デバッグモード対応

### 8. テストの実装 [Priority: Medium]
- [ ] 単体テストの作成
  - [ ] 音声選択ロジックのテスト
  - [ ] 言語検出のテスト
  - [ ] 環境変数処理のテスト
- [ ] 統合テストの作成
- [ ] モックの実装（`say`コマンド）

### 9. 設定ファイルとドキュメント [Priority: High]
- [ ] `dxt.json`: Desktop Extensions設定
- [ ] `README.md`: インストールと使用方法
- [ ] サンプル設定ファイルの作成

### 10. リリース準備 [Priority: Low]
- [ ] バージョニング戦略の決定
- [ ] リリースワークフローの設定
- [ ] Go module の公開準備

## 実装順序の推奨

1. **Phase 1: 基本機能** (タスク1, 2, 6)
   - プロジェクトセットアップ
   - MCPサーバーの基本実装
   - notify_voiceツールの実装

2. **Phase 2: 音声機能** (タスク3, 5)
   - 音声処理の実装
   - 環境変数管理

3. **Phase 3: 高度な機能** (タスク4, 7)
   - 自律的通知
   - エラーハンドリング

4. **Phase 4: 品質とリリース** (タスク8, 9, 10)
   - テスト実装
   - ドキュメント作成
   - リリース準備

## 技術的な注意点

### セキュリティ
- コマンドインジェクション対策を徹底
- 入力値のサニタイゼーション
- ローカル実行のみに制限

### パフォーマンス
- 音声一覧のキャッシング
- 非同期処理の検討
- リソース管理

### 互換性
- macOS専用機能の明確化
- Go 1.21以上の機能使用
- MCPプロトコルの準拠

## 成功基準
- [ ] `go run`コマンドで正常起動
- [ ] Claude Desktop、Claude Code、Cursor、Windsurfとの連携確認
- [ ] 音声通知の正常動作
- [ ] 自律的通知の適切な発動
- [ ] エラー時の適切なフォールバック